{% extends 'base.html' %}
{% load static %}

{% block title %}
  {{ image.title }}
{% endblock %}

{% block scripts %}
  <script type="module" src="{% static 'js/anchorAction.js' %}" defer></script>
  <script type="module" src="{% static 'js/image_like.js' %}" defer></script>
{% endblock %}

{% block content %}
  <h1>{{ image.title }}</h1>
  <a href="{{ image.image.url }}"><img src="{{ image.image.url }}" alt="" class="image-detail" /></a>
  {% with total_likes=image.users_like.count users_like=image.users_like.all %}
    <div class="image-info">
      <div>
        <span class="count"><span class="total">{{ total_likes }} like{{ total_likes|pluralize }}</span></span>
        <span class="count">{{ total_views }} view{{ total_views|pluralize }}</span>
        <a href="{% url 'images:like' %}" data-id="{{ image.id }}" data-action="{% if request.user in users_like %}dis{% endif %}like" class="like button">
          {% if request.user not in users_like %}
            Like
          {% else %}
            Dislike
          {% endif %}
        </a>
      </div>
      <p class="image-detail">{{ image.description }}</p>
    </div>
    <div class="image-likes" id="image-likes">
      <p class="image-detail">Users Like:</p>
      {% for user in image.users_like.all %}
        <div>
          {% if user.profile.photo %}
            <a href="{{ user.get_absolute_url }}"><img src="{{ user.profile.photo.url }}" alt="" /></a>
          {% endif %}
          <p>
            <a href="{{ user.get_absolute_url }}">{{ user.first_name }}</a>
          </p>
        </div>
      {% empty %}
        <div>
          <p>Nobody likes this image yet</p>
        </div>
      {% endfor %}
    </div>
  {% endwith %}
{% endblock %}
